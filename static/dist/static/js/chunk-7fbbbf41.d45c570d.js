(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7fbbbf41"],{4056:function(t,e,n){"use strict";n("68ef"),n("09fe")},"57a0":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user"},[n("div",{staticClass:"user-head"},[n("div",{staticClass:"user-head_row"},[n("div",{staticClass:"flex"},[n("van-image",{staticClass:"user-head_image",attrs:{round:"",fit:"cover","lazy-load":"",src:t.user.head_img},scopedSlots:t._u([{key:"loading",fn:function(){return[n("van-loading",{attrs:{size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}])}),t.showUpload?n("div",{staticClass:"user-head_row__r"},[n("van-button",{attrs:{round:"",type:"default",size:"small",color:"#666"},on:{click:t.onUnshowUpload}},[t._v("取消")]),n("van-button",{attrs:{round:"",type:"info",size:"small"},on:{click:t.handleUpload}},[t._v("完成")])],1):t._e()],1),n("p",{staticClass:"user-head_name van-ellipsis"},[t._v(t._s(t.user.nickname))]),n("van-uploader",{class:{"show-upload":t.showUpload},attrs:{"preview-image":"","max-count":1,"after-read":t.beforeRead},on:{delete:t.onUnshowUpload},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1)]),n("div",{staticClass:"user-info"},[n("van-cell",[n("template",{slot:"title"},[n("span",{staticClass:"custom-title"},[t._v(t._s(t.user.name))])]),n("van-tag",{attrs:{slot:"right-icon",round:"",plain:"",type:"success"},on:{click:t.handleName},slot:"right-icon"},[t._v("账号")])],2),n("van-cell",[n("template",{slot:"title"},[n("span",{staticClass:"custom-title"},[t._v("密码")]),n("van-icon",{attrs:{name:"closed-eye"}})],1),n("van-tag",{attrs:{slot:"right-icon",type:"primary",round:""},on:{click:function(e){return t.handleChange(1)}},slot:"right-icon"},[t._v("密码")])],2),n("van-cell",[n("template",{slot:"title"},[n("span",{staticClass:"custom-title"},[t._v(t._s(t.user.nickname))])]),n("van-tag",{attrs:{slot:"right-icon",type:"primary",round:""},on:{click:function(e){return t.handleChange(0)}},slot:"right-icon"},[t._v("昵称")])],2),n("van-cell",[n("template",{slot:"title"},[n("span",{staticClass:"custom-title"},[t._v(t._s(t.sexs[t.user.sex]))])]),n("van-tag",{attrs:{slot:"right-icon",type:"primary",round:""},on:{click:t.handleChangeSex},slot:"right-icon"},[t._v("性别")])],2)],1),n("van-popup",{attrs:{position:"bottom"},model:{value:t.showPopup,callback:function(e){t.showPopup=e},expression:"showPopup"}},[n("van-picker",{attrs:{"show-toolbar":"",title:"修改性别",columns:t.sexs,"default-index":t.sex},on:{cancel:t.onSexCancel,confirm:t.onSexConfirm}})],1),n("van-dialog",{attrs:{title:t.titles[t.type],"show-cancel-button":"",beforeClose:t.onBeforeClose,closeOnPopstate:!0},on:{cancel:t.onCancel,confirm:t.onConfirm},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[n("div",{staticClass:"user-dialog"},[0===t.type?n("van-cell-group",[n("van-field",{staticClass:"van-hairline--surround",attrs:{maxlength:"12",clearable:"",placeholder:"请输入昵称","error-message":t.errormsg0},model:{value:t.newNickName,callback:function(e){t.newNickName="string"===typeof e?e.trim():e},expression:"newNickName"}})],1):t._e(),1===t.type?n("van-cell-group",[n("van-field",{staticClass:"van-hairline--surround",staticStyle:{"margin-bottom":"10px"},attrs:{type:"password",maxlength:"12",placeholder:"请输入原密码",required:"",clearable:"","error-message":t.errormsg1},model:{value:t.password,callback:function(e){t.password="string"===typeof e?e.trim():e},expression:"password"}})],1):t._e(),1===t.type?n("van-cell-group",[n("van-field",{staticClass:"van-hairline--surround",attrs:{type:"password",maxlength:"12",placeholder:"请输入新密码",required:"",clearable:"","error-message":t.errormsg2},model:{value:t.newpassword,callback:function(e){t.newpassword="string"===typeof e?e.trim():e},expression:"newpassword"}})],1):t._e()],1)])],1)},i=[],o=(n("8e6e"),n("ac6a"),n("456d"),n("96cf"),n("3b8d")),a=n("bd86"),r=(n("ac1e"),n("543e")),c=(n("0653"),n("34e9")),l=(n("c194"),n("7744")),u=(n("66b9"),n("b650")),h=(n("be7f"),n("565f")),f=(n("4056"),n("44bf")),d=(n("8a58"),n("e41f")),m=(n("68ef"),n("a526"),n("c31d")),p=n("d282"),g=n("1325"),v=n("1128");function w(t){return Array.isArray(t)?t.map((function(t){return w(t)})):"object"===typeof t?Object(v["a"])({},t):t}var b={title:String,loading:Boolean,showToolbar:Boolean,cancelButtonText:String,confirmButtonText:String,allowHtml:{type:Boolean,default:!0},visibleItemCount:{type:Number,default:5},itemHeight:{type:Number,default:44}},x=n("b1d2"),y=n("2638"),C=n.n(y),O=n("a142"),I=n("482d"),k=n("3875"),j=200,N=1e3,S=300,_=15,T=Object(p["a"])("picker-column"),U=T[0],P=T[1];function $(t){var e=window.getComputedStyle(t),n=e.transform||e.webkitTransform,s=n.slice(7,n.length-1).split(", ")[5];return Number(s)}function E(t){return Object(O["c"])(t)&&t.disabled}var H,R=U({mixins:[k["a"]],props:{valueKey:String,allowHtml:Boolean,className:String,itemHeight:Number,defaultIndex:Number,visibleItemCount:Number,initialOptions:{type:Array,default:function(){return[]}}},data:function(){return{offset:0,duration:0,options:w(this.initialOptions),currentIndex:this.defaultIndex}},created:function(){this.$parent.children&&this.$parent.children.push(this),this.setIndex(this.currentIndex)},destroyed:function(){var t=this.$parent.children;t&&t.splice(t.indexOf(this),1)},watch:{defaultIndex:function(){this.setIndex(this.defaultIndex)}},computed:{count:function(){return this.options.length},baseOffset:function(){return this.itemHeight*(this.visibleItemCount-1)/2}},methods:{onTouchStart:function(t){if(this.touchStart(t),this.moving){var e=$(this.$refs.wrapper);this.offset=Math.min(0,e-this.baseOffset),this.startOffset=this.offset}else this.startOffset=this.offset;this.duration=0,this.transitionEndTrigger=null,this.touchStartTime=Date.now(),this.momentumOffset=this.startOffset},onTouchMove:function(t){this.moving=!0,this.touchMove(t),"vertical"===this.direction&&Object(g["c"])(t,!0),this.offset=Object(I["a"])(this.startOffset+this.deltaY,-this.count*this.itemHeight,this.itemHeight);var e=Date.now();e-this.touchStartTime>S&&(this.touchStartTime=e,this.momentumOffset=this.offset)},onTouchEnd:function(){var t=this.offset-this.momentumOffset,e=Date.now()-this.touchStartTime,n=e<S&&Math.abs(t)>_;if(n)this.momentum(t,e);else{var s=this.getIndexByOffset(this.offset);this.moving=!1,this.duration=j,this.setIndex(s,!0)}},onTransitionEnd:function(){this.stopMomentum()},onClickItem:function(t){this.moving||(this.duration=j,this.setIndex(t,!0))},adjustIndex:function(t){t=Object(I["a"])(t,0,this.count);for(var e=t;e<this.count;e++)if(!E(this.options[e]))return e;for(var n=t-1;n>=0;n--)if(!E(this.options[n]))return n},getOptionText:function(t){return Object(O["c"])(t)&&this.valueKey in t?t[this.valueKey]:t},setIndex:function(t,e){var n=this;t=this.adjustIndex(t)||0,this.offset=-t*this.itemHeight;var s=function(){t!==n.currentIndex&&(n.currentIndex=t,e&&n.$emit("change",t))};this.moving?this.transitionEndTrigger=s:s()},setValue:function(t){for(var e=this.options,n=0;n<e.length;n++)if(this.getOptionText(e[n])===t)return this.setIndex(n)},getValue:function(){return this.options[this.currentIndex]},getIndexByOffset:function(t){return Object(I["a"])(Math.round(-t/this.itemHeight),0,this.count-1)},momentum:function(t,e){var n=Math.abs(t/e);t=this.offset+n/.002*(t<0?-1:1);var s=this.getIndexByOffset(t);this.duration=N,this.setIndex(s,!0)},stopMomentum:function(){this.moving=!1,this.duration=0,this.transitionEndTrigger&&(this.transitionEndTrigger(),this.transitionEndTrigger=null)},genOptions:function(){var t=this,e=this.$createElement,n={height:this.itemHeight+"px"};return this.options.map((function(s,i){var o=t.getOptionText(s),a=E(s),r={style:n,attrs:{role:"button",tabindex:a?-1:0},class:["van-ellipsis",P("item",{disabled:a,selected:i===t.currentIndex})],on:{click:function(){t.onClickItem(i)}}};return t.allowHtml&&(r.domProps={innerHTML:o}),e("li",C()([{},r]),[t.allowHtml?"":o])}))}},render:function(){var t=arguments[0],e={transform:"translate3d(0, "+(this.offset+this.baseOffset)+"px, 0)",transitionDuration:this.duration+"ms",transitionProperty:this.duration?"all":"none",lineHeight:this.itemHeight+"px"};return t("div",{class:[P(),this.className],on:{touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchEnd}},[t("ul",{ref:"wrapper",style:e,class:P("wrapper"),on:{transitionend:this.onTransitionEnd}},[this.genOptions()])])}}),L=Object(p["a"])("picker"),V=L[0],D=L[1],B=L[2],M=V({props:Object(m["a"])({},b,{defaultIndex:{type:Number,default:0},columns:{type:Array,default:function(){return[]}},toolbarPosition:{type:String,default:"top"},valueKey:{type:String,default:"text"}}),data:function(){return{children:[]}},computed:{simple:function(){return this.columns.length&&!this.columns[0].values}},watch:{columns:"setColumns"},methods:{setColumns:function(){var t=this,e=this.simple?[{values:this.columns}]:this.columns;e.forEach((function(e,n){t.setColumnValues(n,w(e.values))}))},emit:function(t){this.simple?this.$emit(t,this.getColumnValue(0),this.getColumnIndex(0)):this.$emit(t,this.getValues(),this.getIndexes())},onChange:function(t){this.simple?this.$emit("change",this,this.getColumnValue(0),this.getColumnIndex(0)):this.$emit("change",this,this.getValues(),t)},getColumn:function(t){return this.children[t]},getColumnValue:function(t){var e=this.getColumn(t);return e&&e.getValue()},setColumnValue:function(t,e){var n=this.getColumn(t);n&&n.setValue(e)},getColumnIndex:function(t){return(this.getColumn(t)||{}).currentIndex},setColumnIndex:function(t,e){var n=this.getColumn(t);n&&n.setIndex(e)},getColumnValues:function(t){return(this.children[t]||{}).options},setColumnValues:function(t,e){var n=this.children[t];n&&JSON.stringify(n.options)!==JSON.stringify(e)&&(n.options=e,n.setIndex(0))},getValues:function(){return this.children.map((function(t){return t.getValue()}))},setValues:function(t){var e=this;t.forEach((function(t,n){e.setColumnValue(n,t)}))},getIndexes:function(){return this.children.map((function(t){return t.currentIndex}))},setIndexes:function(t){var e=this;t.forEach((function(t,n){e.setColumnIndex(n,t)}))},onConfirm:function(){this.children.map((function(t){return t.stopMomentum()})),this.emit("confirm")},onCancel:function(){this.emit("cancel")}},render:function(t){var e=this,n=this.itemHeight,s=n*this.visibleItemCount,i=this.simple?[this.columns]:this.columns,o={height:n+"px"},a={height:s+"px"},c={backgroundSize:"100% "+(s-n)/2+"px"},l=this.showToolbar&&t("div",{class:[x["f"],D("toolbar")]},[this.slots()||[t("button",{class:D("cancel"),on:{click:this.onCancel}},[this.cancelButtonText||B("cancel")]),this.slots("title")||this.title&&t("div",{class:["van-ellipsis",D("title")]},[this.title]),t("button",{class:D("confirm"),on:{click:this.onConfirm}},[this.confirmButtonText||B("confirm")])]]);return t("div",{class:D()},["top"===this.toolbarPosition?l:t(),this.loading?t(r["a"],{class:D("loading"),attrs:{color:x["a"]}}):t(),this.slots("columns-top"),t("div",{class:D("columns"),style:a,on:{touchmove:g["c"]}},[i.map((function(n,s){return t(R,{attrs:{valueKey:e.valueKey,allowHtml:e.allowHtml,className:n.className,itemHeight:e.itemHeight,defaultIndex:n.defaultIndex||e.defaultIndex,visibleItemCount:e.visibleItemCount,initialOptions:e.simple?n:n.values},on:{change:function(){e.onChange(s)}}})})),t("div",{class:D("mask"),style:c}),t("div",{class:[x["g"],D("frame")],style:o})]),this.slots("columns-bottom"),"bottom"===this.toolbarPosition?l:t()])}}),A=(n("e930"),n("8f80")),K=(n("e17f"),n("2241")),z=(n("7f7f"),n("28a5"),n("2f62")),J=n("74c2"),q=n("413c"),F=n("a4ba");function Y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y(n,!0).forEach((function(e){Object(a["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Q={beforeRouteEnter:function(t,e,n){n((function(t){var n=document.URL,s=n.split("#");t.fromURL=s[0]+"#"+e.fullPath}))},name:"userManagement",components:(H={},Object(a["a"])(H,K["a"].Component.name,K["a"].Component),Object(a["a"])(H,A["a"].name,A["a"]),Object(a["a"])(H,M.name,M),Object(a["a"])(H,d["a"].name,d["a"]),Object(a["a"])(H,f["a"].name,f["a"]),Object(a["a"])(H,h["a"].name,h["a"]),Object(a["a"])(H,u["a"].name,u["a"]),Object(a["a"])(H,l["a"].name,l["a"]),Object(a["a"])(H,c["a"].name,c["a"]),Object(a["a"])(H,r["a"].name,r["a"]),H),data:function(){return{showUpload:!1,fileList:[],newHead_img:"",type:"",showDialog:!1,titles:["修改昵称","修改密码"],newNickName:"",password:"",newpassword:"",errormsg0:"",errormsg1:"",errormsg2:"",sexs:["隐藏","男","女"],sex:0,showPopup:!1,fromURL:""}},computed:G({},Object(z["c"])(["isLogin","user"])),mounted:function(){var t=this;this.sex=this.user.sex,F["a"].$on("popState",(function(e){e===t.$route.path&&t.popState()}))},methods:G({},Object(z["b"])(["setUser"]),{popState:function(){this.showDialog&&(this.showDialog=!1,this.onCancel()),this.showPopup&&(this.showPopup=!1)},beforeRead:function(t){this.showUpload=!0},handleUpload:function(){var t=this;Object(J["a"])(this.fileList[0].content,{width:100}).then((function(e){t.uploadImg(e.base64)})).catch((function(e){t.$toast(e.msg),t.onUnshowUpload()}))},uploadImg:function(t){var e=this;this.$axios.post(RESTFULAPI.public.uploadImg,{type:"head",base64Array:[t]}).then((function(t){e.updataInfo({head_img:t.data.data.pathArray[0]},(function(){e.setUser({head_img:BASEURL+t.data.data.pathArray[0]}),e.onUnshowUpload()}))})).catch((function(t){}))},onUnshowUpload:function(){this.fileList.splice(0,1),this.showUpload=!1},handleChange:function(t){this.$tools.pushState(document.URL,document.URL),this.type=t,this.showDialog=!0,0===this.type&&(this.newNickName=this.user.nickname)},onCancel:function(){0===this.type&&(this.newNickName=this.user.nickname),1===this.type&&(this.password="",this.newpassword="")},onConfirm:function(){var t=this;0===this.type&&this.$tools.isRegNickName(this.newNickName)&&this.updataInfo({nickname:this.newNickName},(function(){t.setUser({nickname:t.newNickName})})),1===this.type&&this.password!=this.newpassword&&this.$tools.isRegPwd(this.newpassword)&&this.updataInfo({password:Object(q["a"])(this.password),newpassword:Object(q["a"])(this.newpassword)},(function(){t.password="",t.newpassword=""}))},onBeforeClose:function(t,e){if(0===this.type&&!this.$tools.isRegNickName(this.newNickName)&&"confirm"==t)return this.errormsg0="昵称是1-12个字符，只能包含中文、字母、数字、下划线",void e(!1);if(this.errormsg0="",1===this.type&&"confirm"==t){if(this.password.length<1)return this.errormsg1="原密码不能为空",void e(!1);if(this.errormsg1="",!this.$tools.isRegPwd(this.newpassword))return this.errormsg2="密码是6-12个字符，只能包含字母、数字、“_”、“-”、“@”",void e(!1);if(this.password==this.newpassword)return this.errormsg2="原密码与新密码不能相同",void e(!1)}this.errormsg2="",e()},handleChangeSex:function(){this.$tools.pushState(document.URL,document.URL),this.showPopup=!0},onSexCancel:function(t){this.showPopup=!1},onSexConfirm:function(t){var e=this;this.updataInfo({sex:this.sexs.indexOf(t)},(function(){e.setUser({sex:e.sexs.indexOf(t)}),e.showPopup=!1}))},handleName:function(){var t=Math.round(Math.random()),e=["账号是唯一的，不可以修改",this.user.name];this.$toast(e[t])},updataInfo:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var n,s,i=this,o=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",s=this.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",message:"请求中..."}),t.next=4,this.$axios.put(RESTFULAPI.public.updateInfo,e).then((function(t){n&&n(),s.clear(),i.$toast(t.data.msg||"修改信息成功")})).catch((function(t){s(t.data.msg)}));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()})},W=Q,X=(n("e180"),n("2877")),Z=Object(X["a"])(W,s,i,!1,null,"1380eebe",null);e["default"]=Z.exports},a526:function(t,e,n){},c194:function(t,e,n){"use strict";n("68ef"),n("09fe")},e180:function(t,e,n){"use strict";var s=n("efb2"),i=n.n(s);i.a},efb2:function(t,e,n){}}]);