(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bdc35506"],{"57a8":function(t,e,i){},"5c70":function(t,e,i){"use strict";i.r(e);var n,o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tweet",attrs:{id:"tweet"},on:{scroll:t.onScroll}},[i("van-nav-bar",{directives:[{name:"show",rawName:"v-show",value:!t.isScroll,expression:"!isScroll"}],attrs:{fixed:"","z-index":4,border:!1},on:{"click-right":t.onWrite}},[i("van-icon",{attrs:{slot:"right",name:"add-o"},slot:"right"})],1),i("div",{staticClass:"tweet-wrap"},[i("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[i("div",{staticClass:"tweet-wrap_cover"},[i("van-image",{staticClass:"tweet-wrap_cover__cover",attrs:{fit:"cover","lazy-load":"",src:"https://img.yzcdn.cn/vant/cat.jpeg"},on:{click:function(e){return t.handleImg(1,0,"https://img.yzcdn.cn/vant/cat.jpeg")}},scopedSlots:t._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}])})],1),i("div",{staticClass:"tweet-list",style:{minHeight:t.docHeight}},[i("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.getTweet},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[t._l(t.list,(function(e,n){return i("div",{key:n,staticClass:"tweet-list_wrap"},[i("div",{staticClass:"tweet-list_item"},[i("div",{staticClass:"tweet-list_item__l",on:{click:function(i){return t.pushHref("/tweet/individual/"+e.authorID._id)}}},[i("van-image",{attrs:{fit:"cover","lazy-load":"",src:t.BASEURL+e.authorID.head_img},scopedSlots:t._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}],null,!0)})],1),i("div",{staticClass:"tweet-list_item__content"},[i("p",{staticClass:"tweet-list_item__content___name",on:{click:function(i){return t.pushHref("/tweet/individual/"+e.authorID._id)}}},[t._v(t._s(e.authorID.nickname))]),i("p",{staticClass:"tweet-list_item__content___text",domProps:{textContent:t._s(e.content)}}),e.images.length?i("div",{staticClass:"tweet-list_item__content___images flex",class:e.images.length>1?"tweet-list_item__content___images-more":""},t._l(e.images,(function(n,o){return i("van-image",{key:o,attrs:{fit:"cover","lazy-load":"",src:t.BASEURL+n},on:{click:function(i){return t.handleImg(e.images.length,o,t.BASEURL+n)}},scopedSlots:t._u([{key:"loading",fn:function(){return[i("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}],null,!0)})})),1):t._e(),i("div",{staticClass:"tweet-list_item__content___bottom flex-nowrap-between-center"},[i("div",{staticClass:"tweet-list_item__content___bottom-date"},[t._v(t._s(t._f("getTimeAgo")(e.creatTime)))]),i("div",[i("div",{staticClass:"flex-nowrap-between-center",on:{click:function(e){return t.$toast("即将开发")}}},[i("div",[i("van-icon",{attrs:{name:"like-o"}}),i("span",[t._v(t._s(e.likes))])],1),i("div",[i("van-icon",{attrs:{name:"chat-o"}}),i("span",[t._v(t._s(e.comments))])],1)])])])])]),i("van-divider",{directives:[{name:"show",rawName:"v-show",value:n!=t.list.length-1,expression:"index!=list.length-1"}]})],1)})),i("van-divider",{directives:[{name:"show",rawName:"v-show",value:t.finished,expression:"finished"}],staticClass:"finished"},[t._v("没有更多了")])],2)],1)])],1),i("van-image-preview",{attrs:{startPosition:t.previewIndex,lazyLoad:"",images:t.previewImages},model:{value:t.showPreview,callback:function(e){t.showPreview=e},expression:"showPreview"}})],1)},s=[],a=(i("8e6e"),i("ac6a"),i("456d"),i("6c7b"),i("75fc")),r=i("bd86"),c=(i("4662"),i("28a2")),l=(i("2b28"),i("9ed2")),d=(i("2994"),i("2bdd")),u=(i("ab71"),i("58e6")),h=(i("7f7f"),i("5246"),i("6b41")),v=i("2f62"),f=i("a4ba");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var w={name:"tweet",inject:["handleShowLogin"],components:(n={},Object(r["a"])(n,h["a"].name,h["a"]),Object(r["a"])(n,u["a"].name,u["a"]),Object(r["a"])(n,d["a"].name,d["a"]),Object(r["a"])(n,l["a"].name,l["a"]),Object(r["a"])(n,c["a"].name,c["a"]),n),data:function(){return{docHeight:"",isLoading:!1,error:!1,list:[],loading:!1,finished:!1,showPreview:!1,previewIndex:0,previewImages:[],scrollTop:0,isScroll:!1,limit:10,previousId:"",BASEURL:BASEURL}},computed:g({},Object(v["c"])(["isLogin","user"])),watch:{$route:function(t){if("/tweet"===t.path){var e=document.getElementById("tweet");e.scrollTop=this.scrollTop,this.isScroll=!1}},scrollTop:function(t,e){this.isScroll=t>e}},created:function(){},mounted:function(){console.log("BASEURL",BASEURL),this.docHeight=document.documentElement.clientHeight-312+"px",f["a"].$on("onMsg",(function(t){console.log("Tweet收到消息是：",t)}))},destroyed:function(){},methods:{getTweet:function(){var t=this;this.$axios.get(RESTFULAPI.public.tweet,{params:{limit:this.limit,previousId:this.previousId}}).then((function(e){var i=e.data.data;t.list=[].concat(Object(a["a"])(t.list),Object(a["a"])(i)),t.previousId=e.data.previousId,t.finished=e.data.nomore,t.loading=!1,!0===t.isLoading&&(t.$toast("刷新成功"),t.isLoading=!1),t.error=!1})).catch((function(e){!1===t.finished?(t.error=!0,t.loading=!1):t.error=!1,!0===t.isLoading&&(t.$toast("刷新失败"),t.isLoading=!1)}))},getData:function(){var t=this;this.$axios.get(API.public.tweet_list).then((function(e){t.list=[].concat(Object(a["a"])(t.list),Object(a["a"])(e.data.data)),t.loading=!1,t.list.length>=130&&(t.finished=!0),!0===t.isLoading&&(t.$toast("刷新成功"),t.isLoading=!1),t.error=!1})).catch((function(e){t.$toast("获取文章详情失败"),t.error=!0,t.loading=!1,!0===t.isLoading&&(t.$toast("刷新失败"),t.isLoading=!1)}))},onRefresh:function(){this.list=[],this.finished=!1,this.loading=!0,this.finished=!1,this.previousId="",this.getTweet()},handleImg:function(t,e,i){this.previewImages=new Array(t).fill(i),this.showPreview=!0,this.previewIndex=e},onWrite:function(){!0===this.isLogin?this.pushHref("/tweet/write"):(this.$toast("请先登录"),this.handleShowLogin())},onScroll:function(t){var e=t||window.event;e.target.scrollTop&&(this.scrollTop=e.target.scrollTop)}}},m=w,_=(i("e44c"),i("2877")),b=Object(_["a"])(m,o,s,!1,null,null,null);e["default"]=b.exports},e44c:function(t,e,i){"use strict";var n=i("57a8"),o=i.n(n);o.a}}]);
//# sourceMappingURL=chunk-bdc35506.bb4a024c.js.map