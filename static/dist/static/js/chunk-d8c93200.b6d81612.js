(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d8c93200"],{2241:function(t,e,n){"use strict";var i,o=n("c31d"),a=n("2b0e"),s=n("d282"),r=n("b1d2"),l=n("6605"),c=n("022e"),d=n("b650"),u=Object(s["a"])("dialog"),h=u[0],f=u[1],p=u[2],v=h({mixins:[l["a"],c["a"]],props:{title:String,message:String,className:null,callback:Function,beforeClose:Function,messageAlign:String,cancelButtonText:String,cancelButtonColor:String,confirmButtonText:String,confirmButtonColor:String,showCancelButton:Boolean,transition:{type:String,default:"van-dialog-bounce"},showConfirmButton:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!1}},data:function(){return{loading:{confirm:!1,cancel:!1}}},methods:{onClickOverlay:function(){this.handleAction("overlay")},handleAction:function(t){var e=this;this.$emit(t),this.beforeClose?(this.loading[t]=!0,this.beforeClose(t,(function(n){!1!==n&&e.loading[t]&&e.onClose(t),e.loading.confirm=!1,e.loading.cancel=!1}))):this.onClose(t)},onClose:function(t){this.close(),this.callback&&this.callback(t)},onOpened:function(){this.$emit("opened")},onClosed:function(){this.$emit("closed")}},render:function(){var t,e,n=this,i=arguments[0];if(this.shouldRender){var o=this.message,a=this.messageAlign,s=this.slots(),l=this.slots("title")||this.title,c=l&&i("div",{class:f("header",{isolated:!o&&!s})},[l]),u=(s||o)&&i("div",{class:f("content")},[s||i("div",{domProps:{innerHTML:o},class:f("message",(t={"has-title":l},t[a]=a,t))})]),h=this.showCancelButton&&this.showConfirmButton,v=i("div",{class:[r["e"],f("footer",{buttons:h})]},[this.showCancelButton&&i(d["a"],{attrs:{size:"large",loading:this.loading.cancel,text:this.cancelButtonText||p("cancel")},class:f("cancel"),style:{color:this.cancelButtonColor},on:{click:function(){n.handleAction("cancel")}}}),this.showConfirmButton&&i(d["a"],{attrs:{size:"large",loading:this.loading.confirm,text:this.confirmButtonText||p("confirm")},class:[f("confirm"),(e={},e[r["c"]]=h,e)],style:{color:this.confirmButtonColor},on:{click:function(){n.handleAction("confirm")}}})]);return i("transition",{attrs:{name:this.transition},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[i("div",{directives:[{name:"show",value:this.value}],attrs:{role:"dialog","aria-labelledby":this.title||o},class:[f(),this.className]},[c,u,v])])}}}),m=n("a142");function g(t){return document.body.contains(t)}function w(){i&&i.$destroy(),i=new(a["a"].extend(v))({el:document.createElement("div"),propsData:{lazyRender:!1}}),i.$on("input",(function(t){i.value=t}))}function _(t){return m["d"]?Promise.resolve():new Promise((function(e,n){i&&g(i.$el)||w(),Object(o["a"])(i,_.currentOptions,t,{resolve:e,reject:n})}))}_.defaultOptions={value:!0,title:"",message:"",overlay:!0,className:"",lockScroll:!0,transition:"van-dialog-bounce",beforeClose:null,messageAlign:"",getContainer:"body",cancelButtonText:"",cancelButtonColor:null,confirmButtonText:"",confirmButtonColor:null,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!1,closeOnClickOverlay:!1,callback:function(t){i["confirm"===t?"resolve":"reject"](t)}},_.alert=_,_.confirm=function(t){return _(Object(o["a"])({showCancelButton:!0},t))},_.close=function(){i&&(i.value=!1)},_.setDefaultOptions=function(t){Object(o["a"])(_.currentOptions,t)},_.resetDefaultOptions=function(){_.currentOptions=Object(o["a"])({},_.defaultOptions)},_.resetDefaultOptions(),_.install=function(){a["a"].use(v)},_.Component=v,a["a"].prototype.$dialog=_;e["a"]=_},"2fcb":function(t,e,n){},"4a0b":function(t,e,n){"use strict";n.r(e);var i,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tweet",attrs:{id:"tweet"},on:{scroll:t.onScroll}},[n("van-nav-bar",{directives:[{name:"show",rawName:"v-show",value:!t.isScroll,expression:"!isScroll"}],staticClass:"tweet-individual-navbar",attrs:{"left-text":"",fixed:"",border:!1,"z-index":5,"left-arrow":""},on:{"click-left":t.onClickLeft}}),n("div",{staticClass:"tweet-wrap"},[n("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[n("div",{staticClass:"tweet-wrap_cover"},[n("van-image",{staticClass:"tweet-wrap_cover__cover",attrs:{fit:"cover","lazy-load":"",src:"https://img.yzcdn.cn/vant/cat.jpeg"},on:{click:function(e){return t.handleImg(1,0,["https://img.yzcdn.cn/vant/cat.jpeg"])}},scopedSlots:t._u([{key:"loading",fn:function(){return[n("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}])}),n("transition",{attrs:{name:"fade"}},[t.author?n("div",{staticClass:"tweet-wrap_cover__head-wrap flex-nowrap-center"},[n("van-image",{staticClass:"tweet-wrap_cover__head",attrs:{fit:"cover","lazy-load":"",src:t.BASEURL+t.author.head_img},on:{click:function(e){return t.handleImg(1,0,[t.author.head_img])}},scopedSlots:t._u([{key:"loading",fn:function(){return[n("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}],null,!1,3034482977)}),n("div",{staticClass:"tweet-wrap_cover__head-right"},[n("p",{staticClass:"tweet-wrap_cover__head-right___name van-ellipsis"},[t._v(t._s(t.author.nickname))]),n("p",{staticClass:"tweet-wrap_cover__head-right___autograph van-ellipsis"},[t._v("我是一条虫，来自这个世界")])])],1):t._e()])],1),n("div",{staticClass:"tweet-list",style:{minHeight:t.docHeight}},[n("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.getTweet},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[t._l(t.list,(function(e,i){return n("div",{key:i,staticClass:"tweet-list_wrap"},[n("div",{staticClass:"tweet-list_item tweet-individual-list_item",on:{click:function(n){return t.pushHref("/tweet/details/"+e._id)}}},[n("div",{staticClass:"tweet-list_item__content"},[n("p",{staticClass:"tweet-list_item__content___text",domProps:{textContent:t._s(e.content)}}),e.images.length?n("div",{staticClass:"tweet-list_item__content___images flex",class:e.images.length>1?"tweet-list_item__content___images-more":""},t._l(e.images,(function(i,o){return n("van-image",{key:o,attrs:{fit:"cover","lazy-load":"",src:t.BASEURL+i},on:{click:function(n){return n.stopPropagation(),t.handleImg(e.images.length,o,e.images)}},scopedSlots:t._u([{key:"loading",fn:function(){return[n("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}],null,!0)})})),1):t._e(),n("div",{staticClass:"tweet-list_item__content___bottom flex-nowrap-between-center"},[n("div",{staticClass:"tweet-list_item__content___bottom-date"},[n("span",[t._v(t._s(t._f("dataget")(e.creatTime)))]),t.oneself?n("span",{staticClass:"tweet-list_item__content___bottom-delete",on:{click:function(n){return n.stopPropagation(),t.onDelete(e._id,i)}}},[t._v("删除")]):t._e()]),n("div",[n("div",{staticClass:"flex-nowrap-between-center"},[n("div",{on:{click:function(n){return n.stopPropagation(),t.onLike(e._id)}}},[n("van-icon",{attrs:{name:!0===e.isLike?"like":"like-o"}}),n("span",[t._v(t._s(e.likes))])],1),n("div",[n("van-icon",{attrs:{name:"chat-o"}}),n("span",[t._v(t._s(e.reviewQuantity))])],1)])])])])]),n("van-divider")],1)})),n("van-divider",{directives:[{name:"show",rawName:"v-show",value:t.finished,expression:"finished"}],staticClass:"finished"},[t._v("没有更多了")])],2)],1)])],1),n("van-image-preview",{attrs:{startPosition:t.previewIndex,lazyLoad:"",images:t.previewImages},model:{value:t.showPreview,callback:function(e){t.showPreview=e},expression:"showPreview"}}),n("van-dialog",{attrs:{title:"是否删除","show-cancel-button":""},on:{cancel:t.handleCancel,confirm:t.handleDelete},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}})],1)},a=[],s=(n("8e6e"),n("ac6a"),n("456d"),n("20d6"),n("75fc")),r=n("bd86"),l=(n("ac1e"),n("543e")),c=(n("4056"),n("44bf")),d=(n("e17f"),n("2241")),u=(n("2b28"),n("9ed2")),h=(n("2994"),n("2bdd")),f=(n("ab71"),n("58e6")),p=(n("7f7f"),n("5246"),n("6b41")),v=n("2f62"),m=n("a4ba");function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(n,!0).forEach((function(e){Object(r["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _={name:"tweet",inject:["handleShowLogin"],components:(i={},Object(r["a"])(i,p["a"].name,p["a"]),Object(r["a"])(i,f["a"].name,f["a"]),Object(r["a"])(i,h["a"].name,h["a"]),Object(r["a"])(i,u["a"].name,u["a"]),Object(r["a"])(i,d["a"].Component.name,d["a"].Component),Object(r["a"])(i,c["a"].name,c["a"]),Object(r["a"])(i,l["a"].name,l["a"]),i),data:function(){return{docHeight:"",isLoading:!1,error:!1,list:[],loading:!1,finished:!1,showPreview:!1,previewIndex:0,previewImages:[],scrollTop:0,isScroll:!1,limit:10,previousId:"",BASEURL:BASEURL,authorID:"",author:"",oneself:!1,showDialog:!1,delete_id:"",delete_index:""}},computed:w({},Object(v["c"])(["isLogin","user"])),watch:{scrollTop:function(t,e){this.isScroll=t>e},author:function(t){t.name==this.user.name&&(this.oneself=!0)}},created:function(){},mounted:function(){var t=this;this.docHeight=document.documentElement.clientHeight-212+"px",this.authorID=this.$route.params.authorID,m["a"].$on("popState",(function(e){e===t.$route.path&&t.popState()}))},destroyed:function(){},methods:{popState:function(){this.showPreview&&(this.showPreview=!1)},getTweet:function(){var t=this;this.$axios.get(RESTFULAPI.public.tweet,{params:{limit:this.limit,previousId:this.previousId,authorID:this.authorID}}).then((function(e){var n=e.data.data;t.author=""==t.author?e.data.author:t.author,t.list=[].concat(Object(s["a"])(t.list),Object(s["a"])(n)),t.previousId=e.data.previousId,t.finished=e.data.nomore,t.loading=!1,!0===t.isLoading&&(t.$toast("刷新成功"),t.isLoading=!1),t.error=!1})).catch((function(e){!1===t.finished?(t.error=!0,t.loading=!1):t.error=!1,!0===t.isLoading&&(t.$toast("刷新失败"),t.isLoading=!1)}))},onRefresh:function(){this.list=[],this.finished=!1,this.loading=!0,this.finished=!1,this.previousId="",this.getTweet()},handleImg:function(t,e,n){this.$tools.pushState(document.URL,this.fromURL);var i=/:\/\//i;this.previewImages=n.map((function(t){var e=i.test(t)?t:BASEURL+t;return e})),this.showPreview=!0,this.previewIndex=e},onWrite:function(){!0===this.isLogin?this.pushHref("/tweet/write"):(this.$toast("请先登录"),this.handleShowLogin())},onScroll:function(t){var e=t||window.event;e.target.scrollTop&&(this.scrollTop=e.target.scrollTop)},onClickLeft:function(){this.$router.go(-1)},onDelete:function(t,e){this.delete_id=t,this.delete_index=e,this.showDialog=!0},handleCancel:function(){this.delete_id="",this.delete_index=""},handleDelete:function(){var t=this;this.$axios.post(RESTFULAPI.public.tweetDelete,{delete_id:this.delete_id}).then((function(e){t.$toast(e.data.msg),t.list.splice(t.delete_index,1)})).catch((function(e){t.$toast(e.data.msg||"退出登录发生错误")}))},onLike:function(t){var e=this;!0===this.isLogin?this.$axios.post(RESTFULAPI.public.tweetLike,{_id:t}).then((function(n){e.list.findIndex((function(e){return e._id==t&&(e.isLike=n.data.isLike,e.likes=n.data.likes),e._id==t}))})).catch((function(t){})):this.$toast("请先登录")}}},b=_,C=(n("a37e"),n("2877")),y=Object(C["a"])(b,o,a,!1,null,"75b3f726",null);e["default"]=y.exports},a37e:function(t,e,n){"use strict";var i=n("f2fa"),o=n.n(i);o.a},e17f:function(t,e,n){"use strict";n("68ef"),n("4d75"),n("09fe"),n("2fcb")},f2fa:function(t,e,n){}}]);