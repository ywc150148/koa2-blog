(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36aeee08"],{"04c5":function(t,e,n){"use strict";n.r(e);var i,a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tweet-write"},[n("van-nav-bar",{attrs:{"left-arrow":"",fixed:"",border:!1},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight}},[n("van-button",{attrs:{slot:"right",type:"primary",size:"small"},slot:"right"},[t._v("发送")])],1),n("div",{staticClass:"tweet-write-wrap"},[n("van-cell-group",[n("van-field",{attrs:{rows:"4",border:!1,type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"请输入你想说的..."},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("div",{staticClass:"tweet-write-uploader"},[n("van-uploader",{attrs:{multiple:"","max-count":9,"preview-size":"115","after-read":t.onAfterRead},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1)],1)],1)},o=[],r=(n("96cf"),n("3b8d")),s=(n("6b54"),n("ac6a"),n("a481"),n("e17f"),n("2241")),l=n("bd86"),c=(n("0653"),n("34e9")),u=(n("ac1e"),n("543e")),f=(n("66b9"),n("b650")),h=(n("be7f"),n("565f")),d=(n("e930"),n("8f80")),p=(n("7f7f"),n("5246"),n("6b41")),m=(n("28a5"),n("6f45")),v=n.n(m),g=n("74c2"),b=n("ad68"),w=(n("a4ba"),{beforeRouteEnter:function(t,e,n){n((function(t){var n=document.URL,i=n.split("#");t.fromURL=i[0]+"#"+e.fullPath}))},name:"",components:(i={},Object(l["a"])(i,p["a"].name,p["a"]),Object(l["a"])(i,d["a"].name,d["a"]),Object(l["a"])(i,h["a"].name,h["a"]),Object(l["a"])(i,f["a"].name,f["a"]),Object(l["a"])(i,u["a"].name,u["a"]),Object(l["a"])(i,c["a"].name,c["a"]),i),data:function(){return{content:"",fileList:[],unSend:!0,pathArray:[]}},computed:{},created:function(){},mounted:function(){var t=this.$tools.getStorage("tweetDraft");null!==t&&(this.content=t.content,this.fileList=t.fileList),window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),history.replaceState(null,null,document.URL),window.addEventListener("popstate",this.onClickLeft,!1))},destroyed:function(){window.removeEventListener("popstate",this.onClickLeft,!1)},beforeDestroy:function(){},beforeRouteLeave:function(t,e,n){t.meta.newData=!this.unSend,n()},methods:{onClickLeft:function(){var t=this,e=""!=this.content||this.fileList.length>0;!0===this.unSend&&!0===e?s["a"].confirm({title:"是否保存草稿？"}).then((function(){t.$tools.setStorage("tweetDraft",{content:t.content,fileList:t.fileList}),t.$router.replace("/tweet")})).catch((function(){t.$tools.removeStorage("tweetDraft"),t.$router.replace("/tweet")})):this.$router.replace("/tweet")},onClickRight:function(){var t=this;if(""==this.content)return this.$toast("请输入你想说的...");if(this.fileList.length>0){var e=new Array;this.fileList.forEach((function(t,n){e.push(t.content)}));var n=this.$toast.loading({duration:0,forbidClick:!0,loadingType:"spinner",content:"上传图片..."});this.$axios.post(RESTFULAPI.public.uploadImg,{type:"tweet",base64Array:e}).then((function(e){n.clear(),t.pathArray=e.data.data.pathArray,("[object Array]"!==Object.prototype.toString.call(t.pathArray)||t.pathArray.length<1)&&(t.pathArray=[]),t.postTweet(t.content,t.pathArray)})).catch((function(e){n.clear(),t.$toast(e.data.msg)}))}else this.postTweet(this.content)},postTweet:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.$axios.post(RESTFULAPI.public.tweetPost,{content:t,images:n}).then((function(t){e.unSend=!1,e.$toast(t.data.msg),e.$tools.removeStorage("tweetDraft"),e.pushHref("/tweet")})).catch((function(t){e.$toast(t.data.msg)}))},onAfterRead:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.fileList.length-1,t.next=3,Object(b["a"])(v.a,e.file).then((function(t){i.fileList[n].content=t.base64})).catch((function(t){i.$toast(t.msg)}));case 3:return Object(g["a"])(this.fileList[n].content).then((function(t){i.fileList[n].content=t.base64})).catch((function(t){i.$toast(t.msg)})),t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}}),y=w,C=(n("12de"),n("2877")),L=Object(C["a"])(y,a,o,!1,null,"3d574726",null);e["default"]=L.exports},"12de":function(t,e,n){"use strict";var i=n("ec9a"),a=n.n(i);a.a},2241:function(t,e,n){"use strict";var i,a=n("c31d"),o=n("2b0e"),r=n("d282"),s=n("b1d2"),l=n("6605"),c=n("022e"),u=n("b650"),f=Object(r["a"])("dialog"),h=f[0],d=f[1],p=f[2],m=h({mixins:[l["a"],c["a"]],props:{title:String,message:String,className:null,callback:Function,beforeClose:Function,messageAlign:String,cancelButtonText:String,cancelButtonColor:String,confirmButtonText:String,confirmButtonColor:String,showCancelButton:Boolean,transition:{type:String,default:"van-dialog-bounce"},showConfirmButton:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!1}},data:function(){return{loading:{confirm:!1,cancel:!1}}},methods:{onClickOverlay:function(){this.handleAction("overlay")},handleAction:function(t){var e=this;this.$emit(t),this.beforeClose?(this.loading[t]=!0,this.beforeClose(t,(function(n){!1!==n&&e.loading[t]&&e.onClose(t),e.loading.confirm=!1,e.loading.cancel=!1}))):this.onClose(t)},onClose:function(t){this.close(),this.callback&&this.callback(t)},onOpened:function(){this.$emit("opened")},onClosed:function(){this.$emit("closed")}},render:function(){var t,e,n=this,i=arguments[0];if(this.shouldRender){var a=this.message,o=this.messageAlign,r=this.slots(),l=this.slots("title")||this.title,c=l&&i("div",{class:d("header",{isolated:!a&&!r})},[l]),f=(r||a)&&i("div",{class:d("content")},[r||i("div",{domProps:{innerHTML:a},class:d("message",(t={"has-title":l},t[o]=o,t))})]),h=this.showCancelButton&&this.showConfirmButton,m=i("div",{class:[s["e"],d("footer",{buttons:h})]},[this.showCancelButton&&i(u["a"],{attrs:{size:"large",loading:this.loading.cancel,text:this.cancelButtonText||p("cancel")},class:d("cancel"),style:{color:this.cancelButtonColor},on:{click:function(){n.handleAction("cancel")}}}),this.showConfirmButton&&i(u["a"],{attrs:{size:"large",loading:this.loading.confirm,text:this.confirmButtonText||p("confirm")},class:[d("confirm"),(e={},e[s["c"]]=h,e)],style:{color:this.confirmButtonColor},on:{click:function(){n.handleAction("confirm")}}})]);return i("transition",{attrs:{name:this.transition},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[i("div",{directives:[{name:"show",value:this.value}],attrs:{role:"dialog","aria-labelledby":this.title||a},class:[d(),this.className]},[c,f,m])])}}}),v=n("a142");function g(t){return document.body.contains(t)}function b(){i&&i.$destroy(),i=new(o["a"].extend(m))({el:document.createElement("div"),propsData:{lazyRender:!1}}),i.$on("input",(function(t){i.value=t}))}function w(t){return v["d"]?Promise.resolve():new Promise((function(e,n){i&&g(i.$el)||b(),Object(a["a"])(i,w.currentOptions,t,{resolve:e,reject:n})}))}w.defaultOptions={value:!0,title:"",message:"",overlay:!0,className:"",lockScroll:!0,transition:"van-dialog-bounce",beforeClose:null,messageAlign:"",getContainer:"body",cancelButtonText:"",cancelButtonColor:null,confirmButtonText:"",confirmButtonColor:null,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!1,closeOnClickOverlay:!1,callback:function(t){i["confirm"===t?"resolve":"reject"](t)}},w.alert=w,w.confirm=function(t){return w(Object(a["a"])({showCancelButton:!0},t))},w.close=function(){i&&(i.value=!1)},w.setDefaultOptions=function(t){Object(a["a"])(w.currentOptions,t)},w.resetDefaultOptions=function(){w.currentOptions=Object(a["a"])({},w.defaultOptions)},w.resetDefaultOptions(),w.install=function(){o["a"].use(m)},w.Component=m,o["a"].prototype.$dialog=w;e["a"]=w},"2fcb":function(t,e,n){},"8f80":function(t,e,n){"use strict";var i=n("c31d"),a=n("d282"),o=n("ea8e"),r=n("a142");function s(t){return Array.isArray(t)?t:[t]}function l(t,e){return new Promise((function(n){var i=new FileReader;i.onload=function(t){n(t.target.result)},"dataUrl"===e?i.readAsDataURL(t):"text"===e&&i.readAsText(t)}))}function c(t,e){return s(t).some((function(t){return t.size>e}))}var u=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function f(t){return u.test(t)}function h(t){return!!t.isImage||(t.file&&t.file.type?0===t.file.type.indexOf("image"):t.url?f(t.url):!!t.content&&0===t.content.indexOf("data:image"))}var d=n("ad06"),p=n("44bf"),m=n("28a2"),v=Object(a["a"])("uploader"),g=v[0],b=v[1];e["a"]=g({inheritAttrs:!1,model:{prop:"fileList"},props:{disabled:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:Number,default:Number.MAX_VALUE},maxCount:{type:Number,default:Number.MAX_VALUE},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"}},computed:{previewSizeWithUnit:function(){return Object(o["a"])(this.previewSize)}},methods:{getDetail:function(t){return void 0===t&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var e=this,n=t.target.files;if(!this.disabled&&n.length){if(n=1===n.length?n[0]:[].slice.call(n),this.beforeRead){var i=this.beforeRead(n,this.getDetail());if(!i)return void this.resetInput();if(i.then)return void i.then((function(){e.readFile(n)})).catch(this.resetInput)}this.readFile(n)}},readFile:function(t){var e=this,n=c(t,this.maxSize);if(Array.isArray(t)){var i=this.maxCount-this.fileList.length;t.length>i&&(t=t.slice(0,i)),Promise.all(t.map((function(t){return l(t,e.resultType)}))).then((function(i){var a=t.map((function(t,e){return{file:t,content:i[e]}}));e.onAfterRead(a,n)}))}else l(t,this.resultType).then((function(i){e.onAfterRead({file:t,content:i},n)}))},onAfterRead:function(t,e){e?this.$emit("oversize",t,this.getDetail()):(this.resetInput(),this.$emit("input",[].concat(this.fileList,s(t))),this.afterRead&&this.afterRead(t,this.getDetail()))},onDelete:function(t,e){var n=this;if(this.beforeDelete){var i=this.beforeDelete(t,this.getDetail(e));if(!i)return;if(i.then)return void i.then((function(){n.deleteFile(t,e)})).catch(r["e"])}this.deleteFile(t,e)},deleteFile:function(t,e){var n=this.fileList.slice(0);n.splice(e,1),this.$emit("input",n),this.$emit("delete",t,this.getDetail(e))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(t){var e=this;if(this.previewFullImage){var n=this.fileList.filter((function(t){return h(t)})),i=n.map((function(t){return t.content||t.url}));Object(m["a"])({images:i,closeOnPopstate:!0,startPosition:n.indexOf(t),onClose:function(){e.$emit("close-preview")}})}},renderPreviewItem:function(t,e){var n=this,i=this.$createElement,a=i(d["a"],{attrs:{name:"delete"},class:b("preview-delete"),on:{click:function(i){i.stopPropagation(),n.onDelete(t,e)}}}),o=h(t)?i(p["a"],{attrs:{fit:this.imageFit,src:t.content||t.url,width:this.previewSize,height:this.previewSize},class:b("preview-image"),on:{click:function(){n.onPreviewImage(t)}}}):i("div",{class:b("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[i(d["a"],{class:b("file-icon"),attrs:{name:"description"}}),i("div",{class:[b("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url])]);return i("div",{class:b("preview"),on:{click:function(){n.$emit("click-preview",t,n.getDetail(e))}}},[o,a])},renderPreviewList:function(){if(this.previewImage)return this.fileList.map(this.renderPreviewItem)},renderUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var e,n=this.slots(),a=t("input",{attrs:Object(i["a"])({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:b("input"),on:{change:this.onChange}});if(n)return t("div",{class:b("input-wrapper")},[n,a]);if(this.previewSize){var o=this.previewSizeWithUnit;e={width:o,height:o}}return t("div",{class:b("upload"),style:e},[t(d["a"],{attrs:{name:"plus"},class:b("upload-icon")}),this.uploadText&&t("span",{class:b("upload-text")},[this.uploadText]),a])}}},render:function(){var t=arguments[0];return t("div",{class:b()},[t("div",{class:b("wrapper")},[this.renderPreviewList(),this.renderUpload()])])}})},ac1e:function(t,e,n){"use strict";n("68ef")},bcd3:function(t,e,n){},e17f:function(t,e,n){"use strict";n("68ef"),n("4d75"),n("09fe"),n("2fcb")},e930:function(t,e,n){"use strict";n("68ef"),n("09fe"),n("4d75"),n("8270"),n("786d"),n("504b"),n("bcd3")},ec9a:function(t,e,n){}}]);